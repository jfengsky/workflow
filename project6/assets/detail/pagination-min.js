KISSY.add(function(c,d,h){var e="beforePageChange",b="afterPageChange",g=13,a="";d.addStatement("for",{start:"for(KS_TEMPL_STAT_PARAM){",end:"}"});function f(i){f.superclass.constructor.apply(this,arguments);this._init()}f.ATTRS={container:{setter:function(i){if(c.isString(i)){return c.one(i)}if(i.offset){return i}return new c.Node(i)}},callback:{value:function(i,k,j){j(i)}},currentPage:{value:1,setter:function(i){return parseInt(i)}},linkTo:{value:"#"},displayPageCount:{value:2,setter:function(i){return parseInt(i)}},alwaysDisplayCount:{value:1,setter:function(i){return parseInt(i)}},totalPage:{value:0,setter:function(i){if(i){this.set("endPage",i+this.get("firstPage")-1)}}},firstPage:{value:1,setter:function(i){return parseInt(i)}},endPage:{value:0},hasNext:{value:true},ellipseText:{value:true},loadCurrentPage:{value:true},template:{value:a},pageRedirectHook:{value:"data-page"},isLoading:{value:false},events:{value:{}}};c.extend(f,c.Base,{_init:function(){var i=this;if(i.get("loadCurrentPage")){i.page(i.get("currentPage"))}else{i.update()}i._bind()},update:function(){var q=this,m=q.get("currentPage"),j=q.get("displayPageCount"),k=q.get("firstPage"),p=q.get("endPage"),n=q.get("alwaysDisplayCount"),o,l,i=q.get("ellipseText");if(p&&i){o=Math.min(Math.max(k,parseInt(m-j)),p-j*2);l=Math.min(p,o+j*2)}else{if(p){o=k;l=p}}c.log([m,i,k,p,n,!!j,Math.max(o,k),Math.min(l,p),q.get("hasNext")]);q.get("container").html(d(q.get("template")).render({currentPage:m,ellipseText:i,startPage:k,endPage:p,alwaysDisplayCount:n,showPageNum:!!j,startIndex:Math.max(o,k),endIndex:Math.min(l,p),hasNext:q.get("hasNext")}));q.fire(b,{idx:m})},_bind:function(){var k=this,i=k.get("container"),j=function(p){var o=new c.Node(p.target),n=parseInt(o.attr(k.get("pageRedirectHook")));if(isNaN(n)){return}p.preventDefault();if(k.get("isLoading")){return}k.page(n)};i.on("click",j);var l=k.get("events"),m=[];c.each(l,function(n){c.each(n,function(p,o){m.push(o)})});c.each(m,function(n){i.on(n,function(q){var p=new c.Node(q.target),o=[];while(p&&p[0]!==i[0]){c.each(l,function(s,r){if(p.hasClass(r)){c.isFunction(s[n])&&o.push(s[n])}});p=p.parent()}c.each(o,function(r){r.call(k,q)})})})},page:function(j){j=parseInt(j);if(isNaN(j)){return}var l=this,k=l.get("endPage");if(l.fire(e,{idx:j})===false){return}l.set("isLoading",true);l.set("currentPage",j);if(k){l.set("hasNext",j<k);l.update()}function m(){if(!k){l.update()}l.set("isLoading",false)}var i=l.get("callback");c.isFunction(i)&&i(j,l,m)},destroy:function(){var i=this;i.get("container").detach();i.get("container").remove()}});return f},{requires:["template"]});
